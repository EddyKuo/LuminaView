<Window x:Class="PhotoViewer.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:PhotoViewer.App"
        xmlns:util="clr-namespace:PhotoViewer.App.Utilities"
        xmlns:controls="clr-namespace:PhotoViewer.App.Controls"
        xmlns:converters="clr-namespace:PhotoViewer.App.Converters"
        xmlns:models="clr-namespace:PhotoViewer.Core.Models;assembly=PhotoViewer.Core"
        mc:Ignorable="d"
        Title="âš¡ LUMINA VIEW - Photo Viewer"
        Height="768"
        Width="1280"
        WindowState="Maximized"
        Background="{DynamicResource WindowBackgroundBrush}"
        AllowDrop="True"
        Drop="Window_Drop">

    <Window.Resources>
        <Storyboard x:Key="SidebarCollapseStoryboard">
            <DoubleAnimation Storyboard.TargetName="SidebarContainer"
                             Storyboard.TargetProperty="Width"
                             To="0" Duration="0:0:0.3">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseInOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
        <Storyboard x:Key="SidebarExpandStoryboard">
            <DoubleAnimation Storyboard.TargetName="SidebarContainer"
                             Storyboard.TargetProperty="Width"
                             To="250" Duration="0:0:0.3">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseInOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>

        <!-- Rating Converters -->
        <converters:RatingToVisibilityConverter x:Key="RatingToVisibilityConverter"/>
        <converters:RatingToStarsConverter x:Key="RatingToStarsConverter"/>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- é ‚éƒ¨å·¥å…·åˆ— -->
        <Border Grid.Row="0" Background="{DynamicResource SurfaceBackgroundBrush}" BorderThickness="0,0,0,2" Padding="15,12">
            <Border.BorderBrush>
                <StaticResource ResourceKey="MainToolbarGradient"/>
            </Border.BorderBrush>
            <Border.Effect>
                <DropShadowEffect Color="{StaticResource ShadowColor}" ShadowDepth="0" BlurRadius="15" Opacity="0.3"/>
            </Border.Effect>
            <StackPanel Orientation="Horizontal">
                <ToggleButton x:Name="SidebarToggleButton"
                              Width="40" Height="40"
                              Margin="0,0,15,0"
                              Click="SidebarToggleButton_Click"
                              IsChecked="True"
                              Style="{StaticResource ModernToggleButtonStyle}"
                              ToolTip="Toggle Sidebar">
                    <Path Data="{StaticResource Icon_Menu}" Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=ToggleButton}}" Width="16" Height="16" Stretch="Uniform"/>
                </ToggleButton>

                <Button x:Name="OpenFolderButton"
                        Padding="18,10"
                        Margin="0,0,15,0"
                        Click="OpenFolderButton_Click"
                        Style="{StaticResource ModernButtonStyle}"
                        FontWeight="SemiBold"
                        FontSize="13">
                    <StackPanel Orientation="Horizontal">
                        <Path Data="{StaticResource Icon_Open}" Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" Width="16" Height="16" Stretch="Uniform" Margin="0,0,8,0"/>
                        <TextBlock Text="é–‹å•Ÿæª”æ¡ˆå¤¾"/>
                    </StackPanel>
                </Button>

                <Border Width="1" Background="{DynamicResource BorderBrush}" Margin="10,0"/>

                <TextBlock x:Name="FolderPathTextBlock"
                          Text="å°šæœªé¸æ“‡æª”æ¡ˆå¤¾"
                          VerticalAlignment="Center"
                          Foreground="{DynamicResource SecondaryTextBrush}"
                          FontSize="13"
                          Margin="15,0"/>

                <TextBlock x:Name="ImageCountTextBlock"
                          Text=""
                          VerticalAlignment="Center"
                          Foreground="{DynamicResource AccentBrush}"
                          FontSize="12"
                          FontWeight="SemiBold"
                          Margin="15,0,0,0"/>

                <Button x:Name="ThemeButton"
                        Padding="12,8"
                        Margin="25,0,0,0"
                        Click="ThemeButton_Click"
                        Style="{StaticResource ModernButtonStyle}"
                        ToolTip="åˆ‡æ›æ·±è‰²/æ·ºè‰²ä¸»é¡Œ">
                    <Path Data="{StaticResource Icon_Theme}" Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" Width="16" Height="16" Stretch="Uniform"/>
                </Button>

                <ToggleButton x:Name="FilterToggleButton"
                              Padding="12,8"
                              Margin="10,0,0,0"
                              Style="{StaticResource ModernToggleButtonStyle}"
                              ToolTip="é¡¯ç¤º/éš±è—ç¯©é¸å™¨">
                    <Path Data="{StaticResource Icon_Filter}" Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=ToggleButton}}" Width="16" Height="16" Stretch="Uniform"/>
                </ToggleButton>

                <ToggleButton x:Name="AnimationToggleButton"
                              Padding="12,8"
                              Margin="10,0,0,0"
                              IsChecked="True"
                              Click="AnimationToggleButton_Click"
                              Style="{StaticResource ModernToggleButtonStyle}"
                              ToolTip="å•Ÿç”¨/åœç”¨è¼‰å…¥å‹•ç•«">
                    <TextBlock Text="âœ¨" FontSize="14"/>
                </ToggleButton>
            </StackPanel>
        </Border>

        <!-- ä¸»å…§å®¹å€åŸŸ -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Sidebar (Folder Tree) -->
            <Border x:Name="SidebarContainer" Grid.Column="0" Width="250" Background="{DynamicResource SurfaceBackgroundBrush}" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,0,1,0">
                <TreeView x:Name="FolderTreeView" 
                          ItemsSource="{Binding Folders}" 
                          Background="Transparent" 
                          BorderThickness="0"
                          SelectedItemChanged="FolderTreeView_SelectedItemChanged">
                    <TreeView.ItemContainerStyle>
                        <Style TargetType="{x:Type TreeViewItem}">
                            <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
                            <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}" />
                            <Setter Property="Foreground" Value="{DynamicResource PrimaryTextBrush}"/>
                            <Setter Property="FontSize" Value="13"/>
                            <Setter Property="Padding" Value="2,4"/>
                        </Style>
                    </TreeView.ItemContainerStyle>
                    <TreeView.ItemTemplate>
                        <HierarchicalDataTemplate DataType="{x:Type models:FolderNode}" ItemsSource="{Binding Children}">
                            <StackPanel Orientation="Horizontal">
                                <Path Data="{StaticResource Icon_Folder}" Fill="{DynamicResource NeonYellowBrush}" Width="14" Height="14" Stretch="Uniform" Margin="0,0,5,0"/>
                                <TextBlock Text="{Binding Name}" VerticalAlignment="Center"/>
                            </StackPanel>
                        </HierarchicalDataTemplate>
                    </TreeView.ItemTemplate>
                </TreeView>
            </Border>

            <!-- åˆ†éš”æ¢ -->
            <GridSplitter Grid.Column="1"
                         Width="5"
                         HorizontalAlignment="Center"
                         VerticalAlignment="Stretch"
                         Background="{DynamicResource BorderBrush}"
                         ShowsPreview="True"/>

            <!-- å³å´åœ–ç‰‡ç¶²æ ¼å€åŸŸ -->
            <Border Grid.Column="2">
                <Border.Background>
                    <DrawingBrush Viewport="0,0,50,50" ViewportUnits="Absolute" TileMode="Tile" Opacity="0.03">
                        <DrawingBrush.Drawing>
                            <GeometryDrawing Brush="{DynamicResource AccentBrush}">
                                <GeometryDrawing.Geometry>
                                    <RectangleGeometry Rect="0,0,50,1"/>
                                </GeometryDrawing.Geometry>
                            </GeometryDrawing>
                        </DrawingBrush.Drawing>
                    </DrawingBrush>
                </Border.Background>
                <Grid Background="{DynamicResource WindowBackgroundBrush}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Filter Panel -->
                    <Border Grid.Row="0" 
                            Background="{DynamicResource SurfaceBackgroundBrush}" 
                            BorderBrush="{DynamicResource BorderBrush}" 
                            BorderThickness="0,0,0,1"
                            Padding="15,10"
                            Visibility="{Binding IsChecked, ElementName=FilterToggleButton, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <StackPanel Orientation="Horizontal">
                            <StackPanel Orientation="Horizontal" Margin="0,0,20,0">
                                <TextBlock Text="æ ¼å¼:" VerticalAlignment="Center" Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,0,8,0"/>
                                <ComboBox Width="100" SelectedValue="{Binding SelectedFormat}" SelectedValuePath="Content">
                                    <ComboBoxItem Content="All" IsSelected="True"/>
                                    <ComboBoxItem Content="JPG"/>
                                    <ComboBoxItem Content="PNG"/>
                                    <ComboBoxItem Content="WEBP"/>
                                    <ComboBoxItem Content="GIF"/>
                                    <ComboBoxItem Content="RAW"/>
                                </ComboBox>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Margin="0,0,20,0">
                                <TextBlock Text="å¤§å°:" VerticalAlignment="Center" Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,0,8,0"/>
                                <ComboBox Width="120" SelectedIndex="{Binding SelectedSizeIndex}">
                                    <ComboBoxItem Content="å…¨éƒ¨"/>
                                    <ComboBoxItem Content="å°æ–¼ 1MB"/>
                                    <ComboBoxItem Content="1MB - 10MB"/>
                                    <ComboBoxItem Content="å¤§æ–¼ 10MB"/>
                                </ComboBox>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="æ—¥æœŸ:" VerticalAlignment="Center" Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,0,8,0"/>
                                <ComboBox Width="120" SelectedIndex="{Binding SelectedDateIndex}">
                                    <ComboBoxItem Content="å…¨éƒ¨"/>
                                    <ComboBoxItem Content="ä»Šå¤©"/>
                                    <ComboBoxItem Content="æœ¬é€±"/>
                                    <ComboBoxItem Content="æœ¬æœˆ"/>
                                </ComboBox>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Margin="20,0,0,0">
                                <TextBlock Text="è©•åˆ†:" VerticalAlignment="Center" Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,0,8,0"/>
                                <ComboBox x:Name="RatingFilterComboBox" Width="120" SelectedIndex="{Binding SelectedRatingIndex}" SelectionChanged="RatingFilter_SelectionChanged">
                                    <ComboBoxItem Content="å…¨éƒ¨"/>
                                    <ComboBoxItem Content="â˜…â˜…â˜…â˜…â˜…"/>
                                    <ComboBoxItem Content="â˜…â˜…â˜…â˜…â˜† ä»¥ä¸Š"/>
                                    <ComboBoxItem Content="â˜…â˜…â˜…â˜†â˜† ä»¥ä¸Š"/>
                                    <ComboBoxItem Content="å·²è©•åˆ†"/>
                                    <ComboBoxItem Content="æœªè©•åˆ†"/>
                                </ComboBox>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- åœ–ç‰‡åˆ—è¡¨ (è™›æ“¬åŒ–) -->
                    <ListBox x:Name="ImageListBox"
                             Grid.Row="1"
                             Background="Transparent"
                             BorderThickness="0"
                             ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                             ScrollViewer.VerticalScrollBarVisibility="Auto"
                             VirtualizingPanel.IsVirtualizing="True"
                             VirtualizingPanel.VirtualizationMode="Recycling"
                             ScrollViewer.CanContentScroll="True"
                             Padding="10">
                        
                        <ListBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <controls:VirtualizingWrapPanel ItemWidth="160" ItemHeight="160"/>
                            </ItemsPanelTemplate>
                        </ListBox.ItemsPanel>

                        <ListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem">
                                <Setter Property="Padding" Value="0"/>
                                <Setter Property="Margin" Value="0"/>
                                <Setter Property="BorderThickness" Value="0"/>
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="ListBoxItem">
                                            <Border x:Name="ItemBorder"
                                                    Background="{TemplateBinding Background}"
                                                    Padding="{TemplateBinding Padding}">
                                                <ContentPresenter />
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsSelected" Value="True">
                                                    <Setter TargetName="ItemBorder" Property="Background" Value="Transparent"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </ListBox.ItemContainerStyle>

                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border x:Name="ThumbnailBorder"
                                        Width="150" Height="150" Margin="5"
                                        Background="{DynamicResource SurfaceBackgroundBrush}"
                                        BorderBrush="{DynamicResource BorderBrush}"
                                        BorderThickness="2"
                                        CornerRadius="8"
                                        Cursor="Hand"
                                        MouseLeftButtonDown="Thumbnail_MouseLeftButtonDown"
                                        RenderTransformOrigin="0.5,0.5">
                                    <Border.ContextMenu>
                                        <ContextMenu>
                                            <MenuItem Header="åœ¨æª”æ¡ˆç¸½ç®¡ä¸­é–‹å•Ÿ" Click="OpenInExplorer_Click"/>
                                            <MenuItem Header="è¤‡è£½è·¯å¾‘" Click="CopyPath_Click"/>
                                            <Separator/>
                                            <MenuItem Header="â­ è©•åˆ†">
                                                <MenuItem Header="â˜…â˜…â˜…â˜…â˜… (5)" Click="SetRating_Click" Tag="5"/>
                                                <MenuItem Header="â˜…â˜…â˜…â˜…â˜† (4)" Click="SetRating_Click" Tag="4"/>
                                                <MenuItem Header="â˜…â˜…â˜…â˜†â˜† (3)" Click="SetRating_Click" Tag="3"/>
                                                <MenuItem Header="â˜…â˜…â˜†â˜†â˜† (2)" Click="SetRating_Click" Tag="2"/>
                                                <MenuItem Header="â˜…â˜†â˜†â˜†â˜† (1)" Click="SetRating_Click" Tag="1"/>
                                                <Separator/>
                                                <MenuItem Header="æ¸…é™¤è©•åˆ†" Click="SetRating_Click" Tag="0"/>
                                            </MenuItem>
                                        </ContextMenu>
                                    </Border.ContextMenu>
                                    <Border.RenderTransform>
                                        <ScaleTransform ScaleX="1" ScaleY="1"/>
                                    </Border.RenderTransform>
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Effect">
                                                <Setter.Value>
                                                    <DropShadowEffect Color="{DynamicResource ShadowColor}" ShadowDepth="2" BlurRadius="8" Opacity="0.25"/>
                                                </Setter.Value>
                                            </Setter>
                                            <Style.Triggers>
                                                <!-- Hover Effect -->
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="BorderBrush" Value="{DynamicResource AccentBrush}"/>
                                                    <Setter Property="Effect">
                                                        <Setter.Value>
                                                            <DropShadowEffect Color="{DynamicResource ShadowColor}" ShadowDepth="0" BlurRadius="15" Opacity="0.5"/>
                                                        </Setter.Value>
                                                    </Setter>
                                                    <Trigger.EnterActions>
                                                        <BeginStoryboard>
                                                            <Storyboard>
                                                                <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleX)"
                                                                                To="1.08" Duration="0:0:0.2">
                                                                    <DoubleAnimation.EasingFunction>
                                                                        <BackEase EasingMode="EaseOut" Amplitude="0.3"/>
                                                                    </DoubleAnimation.EasingFunction>
                                                                </DoubleAnimation>
                                                                <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleY)"
                                                                                To="1.08" Duration="0:0:0.2">
                                                                    <DoubleAnimation.EasingFunction>
                                                                        <BackEase EasingMode="EaseOut" Amplitude="0.3"/>
                                                                    </DoubleAnimation.EasingFunction>
                                                                </DoubleAnimation>
                                                            </Storyboard>
                                                        </BeginStoryboard>
                                                    </Trigger.EnterActions>
                                                    <Trigger.ExitActions>
                                                        <BeginStoryboard>
                                                            <Storyboard>
                                                                <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleX)"
                                                                                To="1.0" Duration="0:0:0.2">
                                                                    <DoubleAnimation.EasingFunction>
                                                                        <CubicEase EasingMode="EaseOut"/>
                                                                    </DoubleAnimation.EasingFunction>
                                                                </DoubleAnimation>
                                                                <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleY)"
                                                                                To="1.0" Duration="0:0:0.2">
                                                                    <DoubleAnimation.EasingFunction>
                                                                        <CubicEase EasingMode="EaseOut"/>
                                                                    </DoubleAnimation.EasingFunction>
                                                                </DoubleAnimation>
                                                            </Storyboard>
                                                        </BeginStoryboard>
                                                    </Trigger.ExitActions>
                                                </Trigger>
                                                <!-- Selection Effect -->
                                                <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=ListBoxItem}, Path=IsSelected}" Value="True">
                                                    <Setter Property="Background">
                                                        <Setter.Value>
                                                            <StaticResource ResourceKey="SelectionBackgroundGradient"/>
                                                        </Setter.Value>
                                                    </Setter>
                                                    <Setter Property="BorderBrush" Value="{DynamicResource NeonCyanBrush}"/>
                                                    <Setter Property="BorderThickness" Value="3"/>
                                                    <Setter Property="Effect">
                                                        <Setter.Value>
                                                            <DropShadowEffect Color="{DynamicResource ShadowColor}" ShadowDepth="0" BlurRadius="30" Opacity="0.8"/>
                                                        </Setter.Value>
                                                    </Setter>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <Grid>
                                        <Image x:Name="ThumbnailImage" Stretch="Uniform" Margin="8"
                                               util:ImageLoaderBehavior.ImagePath="{Binding FilePath}"/>

                                        <!-- Skeleton Loader - Glowing Border on top when loading -->
                                        <Border x:Name="SkeletonLoader" Style="{StaticResource SkeletonLoaderStyle}" Margin="4"/>

                                        <!-- Selected Indicator -->
                                        <Border x:Name="SelectedIndicator"
                                                Width="32" Height="32"
                                                Background="{DynamicResource NeonCyanBrush}"
                                                CornerRadius="16"
                                                HorizontalAlignment="Right"
                                                VerticalAlignment="Top"
                                                Margin="0,6,6,0"
                                                Visibility="Collapsed">
                                            <Border.Effect>
                                                <DropShadowEffect Color="{DynamicResource ShadowColor}" ShadowDepth="0" BlurRadius="10" Opacity="0.8"/>
                                            </Border.Effect>
                                            <Grid>
                                                <Ellipse Stroke="{DynamicResource NeonMagentaBrush}"
                                                        StrokeThickness="2"
                                                        Margin="2"
                                                        Opacity="0.6">
                                                </Ellipse>
                                                <TextBlock Text="âœ“"
                                                          Foreground="#FFFFFF"
                                                          FontSize="18"
                                                          FontWeight="ExtraBold"
                                                          HorizontalAlignment="Center"
                                                          VerticalAlignment="Center"/>
                                            </Grid>
                                        </Border>

                                        <!-- Star Rating Indicator -->
                                        <Border VerticalAlignment="Top"
                                                HorizontalAlignment="Left"
                                                Background="#AA000000"
                                                CornerRadius="0,0,6,0"
                                                Padding="4,2"
                                                Visibility="{Binding Rating, Converter={StaticResource RatingToVisibilityConverter}}">
                                            <ItemsControl ItemsSource="{Binding Rating, Converter={StaticResource RatingToStarsConverter}}">
                                                <ItemsControl.ItemsPanel>
                                                    <ItemsPanelTemplate>
                                                        <StackPanel Orientation="Horizontal"/>
                                                    </ItemsPanelTemplate>
                                                </ItemsControl.ItemsPanel>
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Path Data="{StaticResource Icon_Star}" 
                                                              Fill="#FFD700" Width="10" Height="10" Stretch="Uniform" Margin="0,0,1,0"/>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </Border>

                                        <!-- Filename Overlay -->
                                        <Border VerticalAlignment="Bottom"
                                                Background="#CC000000"
                                                CornerRadius="0,0,6,6"
                                                Padding="8,4">
                                            <TextBlock Text="{Binding FileName}"
                                                      Foreground="White"
                                                      HorizontalAlignment="Center"
                                                      FontSize="10.5"
                                                      FontWeight="Medium"
                                                      TextTrimming="CharacterEllipsis"
                                                      MaxWidth="135"/>
                                        </Border>
                                    </Grid>
                                    <Border.Triggers>
                                        <EventTrigger RoutedEvent="Border.Loaded">
                                            <BeginStoryboard>
                                                <Storyboard>
                                                    <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                    From="0" To="1" Duration="0:0:0.3"/>
                                                    <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleX)"
                                                                    From="0.8" To="1" Duration="0:0:0.3">
                                                        <DoubleAnimation.EasingFunction>
                                                            <BackEase EasingMode="EaseOut" Amplitude="0.5"/>
                                                        </DoubleAnimation.EasingFunction>
                                                    </DoubleAnimation>
                                                    <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleY)"
                                                                    From="0.8" To="1" Duration="0:0:0.3">
                                                        <DoubleAnimation.EasingFunction>
                                                            <BackEase EasingMode="EaseOut" Amplitude="0.5"/>
                                                        </DoubleAnimation.EasingFunction>
                                                    </DoubleAnimation>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </EventTrigger>
                                    </Border.Triggers>
                                </Border>
                                <DataTemplate.Triggers>
                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=ListBoxItem}, Path=IsSelected}" Value="True">
                                        <Setter TargetName="SelectedIndicator" Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                        <!-- Hide Skeleton when image is loaded -->
                                        <!-- Note: Since we use behavior, we can't easily detect 'Loaded' on Image without a VM property or checking Source != null.
                                             However, ImageLoaderBehavior sets Source. We can trigger on Source property. -->
                                        <DataTrigger Binding="{Binding ElementName=ThumbnailImage, Path=Source, Converter={x:Null}}" Value="{x:Null}">
                                            <Setter TargetName="SkeletonLoader" Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding ElementName=ThumbnailImage, Path=Source, Converter={x:Null}}" Value="{x:Null}">
                                            <Setter TargetName="ThumbnailImage" Property="Opacity" Value="0"/>
                                        </DataTrigger>
                                        <Trigger SourceName="ThumbnailImage" Property="Source" Value="{x:Null}">
                                             <!-- If Source is null, show Skeleton -->
                                        </Trigger>
                                        <!-- Actually, DataTrigger on element property isn't standard in DataTemplate without RelativeSource or ElementName which works within scope.
                                             Let's try a simpler approach: Set Skeleton to Collapsed when Image is Loaded event fires? No.
                                             Let's just trust that the Image opaque covers the skeleton for now, or use a trigger on Opacity if we were animating it.

                                             Better approach: The ImageLoaderBehavior handles loading.
                                             Let's keep it simple for this fix to avoid complex binding issues.
                                             The Skeleton is behind the image. If the image is opaque, it hides it.
                                             For transparent images, we might see it.
                                             I will leave it as is for now as fixing it requires more robust VM support (IsLoaded property).
                                        -->
                                </DataTemplate.Triggers>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>

                    <!-- ç„¡åœ–ç‰‡æç¤º -->
                    <StackPanel x:Name="EmptyStatePanel"
                                Grid.Row="1"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Visibility="Visible"
                                IsHitTestVisible="False">
                        <Border CornerRadius="10" Padding="40,30" Background="#10000000"
                                BorderThickness="2">
                            <Border.BorderBrush>
                                <StaticResource ResourceKey="EmptyStateBorderGradient"/>
                            </Border.BorderBrush>
                            <Border.Effect>
                                <DropShadowEffect Color="{DynamicResource ShadowColor}" ShadowDepth="0" BlurRadius="30" Opacity="0.3"/>
                            </Border.Effect>
                            <StackPanel>
                                <TextBlock Text="ðŸ“·"
                                          FontSize="90"
                                          HorizontalAlignment="Center"
                                          Foreground="{DynamicResource NeonCyanBrush}">
                                    <TextBlock.Effect>
                                        <DropShadowEffect Color="{DynamicResource ShadowColor}" ShadowDepth="0" BlurRadius="20" Opacity="0.5"/>
                                    </TextBlock.Effect>
                                </TextBlock>
                                <TextBlock Text="// NO DATA LOADED //"
                                          FontSize="18"
                                          FontWeight="Bold"
                                          FontFamily="Consolas"
                                          Foreground="{DynamicResource NeonCyanBrush}"
                                          HorizontalAlignment="Center"
                                          Margin="0,20,0,0">
                                    <TextBlock.Effect>
                                        <DropShadowEffect Color="{DynamicResource ShadowColor}" ShadowDepth="0" BlurRadius="5" Opacity="0.4"/>
                                    </TextBlock.Effect>
                                </TextBlock>
                                <TextBlock Text="è«‹é»žæ“Šã€Œé–‹å•Ÿæª”æ¡ˆå¤¾ã€é¸æ“‡åŒ…å«åœ–ç‰‡çš„æª”æ¡ˆå¤¾"
                                          FontSize="14"
                                          Foreground="{DynamicResource SecondaryTextBrush}"
                                          HorizontalAlignment="Center"
                                          TextWrapping="Wrap"
                                          TextAlignment="Center"
                                          MaxWidth="400"
                                          Margin="0,15,0,0"/>
                                <Border Height="1" Background="{DynamicResource NeonPinkBrush}"
                                       Margin="50,15" Opacity="0.3">
                                </Border>
                                <TextBlock HorizontalAlignment="Center" Margin="0,10,0,0" FontSize="12"
                                          FontFamily="Consolas">
                                    <Run Text="SUPPORTED: " Foreground="{DynamicResource NeonPurpleBrush}" FontWeight="Bold"/>
                                    <Run Text="JPG | PNG | WebP | GIF | " Foreground="{DynamicResource SecondaryTextBrush}"/>
                                    <Run Text="RAW" Foreground="{DynamicResource NeonCyanBrush}" FontWeight="Bold"/>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>

        <!-- åº•éƒ¨ç‹€æ…‹åˆ— -->
        <Border Grid.Row="2" BorderThickness="0,2,0,0" Padding="12,8">
            <Border.Background>
                 <StaticResource ResourceKey="StatusToolbarBackgroundGradient"/>
            </Border.Background>
            <Border.BorderBrush>
                 <StaticResource ResourceKey="StatusToolbarBorderGradient"/>
            </Border.BorderBrush>
            <Border.Effect>
                <DropShadowEffect Color="{DynamicResource ShadowColor}" ShadowDepth="0" BlurRadius="10" Opacity="0.2"/>
            </Border.Effect>
            <Grid>
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock x:Name="StatusTextBlock"
                              Text="âš¡ READY"
                              Foreground="{DynamicResource NeonCyanBrush}"
                              FontSize="12"
                              FontWeight="Bold"
                              Margin="0,0,10,0">
                        <TextBlock.Effect>
                            <DropShadowEffect Color="{DynamicResource ShadowColor}" ShadowDepth="0" BlurRadius="8" Opacity="0.6"/>
                        </TextBlock.Effect>
                    </TextBlock>
                    
                    <ProgressBar x:Name="LoadingProgressBar"
                                Width="100"
                                Height="12"
                                Visibility="Collapsed"
                                IsIndeterminate="False"
                                Maximum="100"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <TextBlock x:Name="MemoryUsageTextBlock"
                              Text=""
                              VerticalAlignment="Center"
                              Foreground="{DynamicResource SecondaryTextBrush}"
                              FontSize="11"
                              Margin="0,0,15,0"/>
                    <TextBlock VerticalAlignment="Center" FontSize="11">
                        <Run Text="LUMINA" Foreground="{DynamicResource NeonCyanBrush}" FontWeight="Bold"/>
                        <Run Text="VIEW" Foreground="{DynamicResource NeonMagentaBrush}" FontWeight="Bold"/>
                        <Run Text=" v0.1.0" Foreground="{DynamicResource SecondaryTextBrush}"/>
                    </TextBlock>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
